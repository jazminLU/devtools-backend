
externalDatabase:
  enabled: true
  host: "moon-dev-db.cut6myocef6c.us-east-1.rds.amazonaws.com"
  port: "5432"
  database: "dbmoondev"
  username: "postgres"
  existingSecret: "rds-postgresql-secret"
  existingSecretKey: "password"

backend:
  enabled: true
  image:
    repository: 558497223978.dkr.ecr.us-east-1.amazonaws.com/moon-backend
    tag: "latest"
    pullPolicy: IfNotPresent
  replicas: 2
  service:
    type: ClusterIP
    port: 8000
  env:
    PYTHONUNBUFFERED: "1"
    CORS_ORIGINS: "http://localhost:5173,http://localhost:3000,https://app.infra-moon.com,http://app.infra-moon.com,*"

    DB_HOST: "moon-dev-db.cut6myocef6c.us-east-1.rds.amazonaws.com"
    DB_PORT: "5432"
    DB_NAME: "dbmoondev"
    DB_USER: "postgres"

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 40
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 20
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # Backend Ingress Configuration for api.infra-moon.com
  # Movido de la sección 'ingress' a 'backend.ingress' para usar el nuevo template backend-ingress.yaml
  # de la versión 1.0.2 del chart
  ingress:
    enabled: true
    className: "alb"
    annotations:
      # AWS ALB Ingress Controller annotations
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
      alb.ingress.kubernetes.io/ssl-redirect: '443'
      # Health check configuration
      alb.ingress.kubernetes.io/healthcheck-path: /health
      alb.ingress.kubernetes.io/healthcheck-interval-seconds: '30'
      alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
      alb.ingress.kubernetes.io/healthy-threshold-count: '2'
      alb.ingress.kubernetes.io/unhealthy-threshold-count: '3'
      # SSL/TLS certificate (ARN del certificado en ACM)
      alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:558497223978:certificate/0030a136-17b6-4444-9dac-ebbbd3cb4c77
      # Tags para el ALB
      alb.ingress.kubernetes.io/tags: Environment=dev,Project=devtools-playground,Component=backend-api
    hosts:
      - host: api.infra-moon.com
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                # Nombre correcto del servicio del backend
                name: devtools-playground-backend-backend
                port: 8000
    tls: []

frontend:
  enabled: false

